<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="ê³µì¡°ì„¤ë¹„ ì ê²€ ë° ê´€ë¦¬ ì‹œìŠ¤í…œ">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HVAC ê´€ë¦¬">
    
    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-wind"></i>
                <h1>HVAC ì¥ë¹„ ê´€ë¦¬</h1>
            </div>
            <p class="subtitle">ê³µì¡°ì„¤ë¹„ ì ê²€ ë° ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            
            <!-- ì‚¬ìš©ì ì •ë³´ -->
            <div id="userInfo" class="user-info" style="display: none;">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">ì‚¬ìš©ì</div>
                    <div class="user-role" id="userRole">ì—­í• </div>
                </div>
                <button onclick="logout()" class="btn-logout" title="ë¡œê·¸ì•„ì›ƒ">
                    <i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </div>

        <div class="main-menu">
            <div class="menu-card" onclick="goToInspection()">
                <div class="card-icon inspector">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <h2>ì¥ë¹„ ì ê²€</h2>
                <p>í˜„ì¥ ì¥ë¹„ ì ê²€ ë° ë°ì´í„° ì…ë ¥</p>
                <div class="card-badge">ì ê²€ì</div>
            </div>

            <div class="menu-card" onclick="goToDashboard()">
                <div class="card-icon manager">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h2>ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h2>
                <p>í†µê³„, ì°¨íŠ¸ ë° ì ê²€ ë‚´ì—­ ì¡°íšŒ</p>
                <div class="card-badge">ê´€ë¦¬ì</div>
            </div>
            
            <div class="menu-card admin-only" onclick="goToAdmin()" style="display: none;">
                <div class="card-icon admin">
                    <i class="fas fa-cog"></i>
                </div>
                <h2>ì‹œìŠ¤í…œ ê´€ë¦¬</h2>
                <p>ì ê²€ì ë° ì¥ë¹„ ê´€ë¦¬</p>
                <div class="card-badge">ê´€ë¦¬ì</div>
            </div>
        </div>

        <div class="quick-access">
            <h3><i class="fas fa-bolt"></i> ë¹ ë¥¸ ì ‘ê·¼</h3>
            <div class="quick-buttons">
                <button onclick="openQRScanner()" class="btn-qr">
                    <i class="fas fa-qrcode"></i> QR ìŠ¤ìº”
                </button>
                <button onclick="location.href='qr-generator.html'" class="btn-qr">
                    <i class="fas fa-qrcode"></i> QR ìƒì„±
                </button>
                <button onclick="location.href='equipment-list.html'" class="btn-list">
                    <i class="fas fa-list"></i> ì¥ë¹„ ëª©ë¡
                </button>
                <button onclick="location.href='equipment-search.html'" class="btn-search">
                    <i class="fas fa-search"></i> ì¥ë¹„ ê²€ìƒ‰
                </button>
            </div>
        </div>

        <div class="footer">
            <p> HVAC Equipment Management System </p>
            <p> Â© 2025 Dongjin Air Tech. All rights reserved.</p>
        </div>
    </div>

    <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ íŒì—… -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-lock"></i>
                <h3 id="modalTitle">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
            </div>
            <div class="modal-body">
                <p id="modalDescription">ì ‘ê·¼í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" maxlength="20">
                <div class="password-hint" id="passwordHint"></div>
            </div>
            <div class="modal-footer">
                <button onclick="closePasswordModal()" class="btn-cancel">
                    <i class="fas fa-times"></i> ì·¨ì†Œ
                </button>
                <button onclick="submitPassword()" class="btn-submit">
                    <i class="fas fa-check"></i> í™•ì¸
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSvObiEPfQkEfSLRzyg2BdCCJmQENJs8ic",
            authDomain: "hvac-management-477fb.firebaseapp.com",
            projectId: "hvac-management-477fb",
            storageBucket: "hvac-management-477fb.firebasestorage.app",
            messagingSenderId: "812239966797",
            appId: "1:812239966797:web:b454d99fde982328f7dea04",
            measurementId: "G-f14YESP0P1"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make db available globally
        window.db = db;
    </script>
    <script src="js/firebase-config.js"></script>
    <script src="js/auth-manager.js"></script>
    <script src="js/main.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('âœ… Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                        
                        // ì—…ë°ì´íŠ¸ í™•ì¸
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('ğŸ”„ ìƒˆë¡œìš´ Service Worker ë°œê²¬');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // ìƒˆ ë²„ì „ì´ ì„¤ì¹˜ë¨ - ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                                    console.log('ğŸ†• ìƒˆ ë²„ì „ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.');
                                    // ì„ íƒì‚¬í•­: ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ í‘œì‹œ
                                    if (confirm('ìƒˆ ë²„ì „ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('âŒ Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            });
            
            // Service Worker ì œì–´ ë³€ê²½ ê°ì§€
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                console.log('ğŸ”„ Service Worker ì œì–´ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        } else {
            console.warn('âš ï¸ ì´ ë¸Œë¼ìš°ì €ëŠ” Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
        
        // ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('ğŸ“± PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì¤€ë¹„');
            e.preventDefault();
            deferredPrompt = e;
            
            // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ (ì„ íƒì‚¬í•­)
            // showInstallButton();
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('âœ… PWAê°€ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
            deferredPrompt = null;
        });
        
        // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ê°ì§€
        window.addEventListener('online', () => {
            console.log('ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœë¡œ ì „í™˜');
            // ì„ íƒì‚¬í•­: ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        });
        
        window.addEventListener('offline', () => {
            console.log('ğŸ“´ ì˜¤í”„ë¼ì¸ ìƒíƒœë¡œ ì „í™˜');
            // ì„ íƒì‚¬í•­: ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        });
    </script>
</body>
</html>
