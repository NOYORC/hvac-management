<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>정비내역 - HVAC 관리</title>    
    <!-- PWA Meta Tags -->
    <meta name="description" content="공조설비 점검 및 관리 시스템">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HVAC 관리">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/svg+xml" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/equipment-history.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="btn-back" onclick="location.href='equipment-search.html'">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1><i class="fas fa-history"></i> 정비내역</h1>
        </div>

        <!-- 장비 정보 카드 -->
        <div id="equipmentInfoCard" class="equipment-info-card">
            <!-- 동적으로 생성 -->
        </div>

        <!-- 통계 카드 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalInspections">0</div>
                    <div class="stat-label">총 점검 수</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #4CAF50 0%, #81C784 100%);">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="normalCount">0</div>
                    <div class="stat-label">정상</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #FF9800 0%, #FFB74D 100%);">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="warningCount">0</div>
                    <div class="stat-label">주의/경고</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f44336 0%, #e57373 100%);">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="faultCount">0</div>
                    <div class="stat-label">고장</div>
                </div>
            </div>
        </div>

        <!-- 필터 & 액션 바 -->
        <div class="filter-action-bar">
            <div class="filter-groups">
                <div class="filter-group">
                    <label><i class="fas fa-calendar"></i> 기간</label>
                    <select id="periodFilter">
                        <option value="all">전체</option>
                        <option value="today">오늘</option>
                        <option value="7days">최근 7일</option>
                        <option value="30days" selected>최근 30일</option>
                        <option value="90days">최근 90일</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label><i class="fas fa-info-circle"></i> 상태</label>
                    <select id="statusFilter">
                        <option value="">전체</option>
                        <option value="정상">정상</option>
                        <option value="주의">주의</option>
                        <option value="경고">경고</option>
                        <option value="고장">고장</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label><i class="fas fa-wrench"></i> 점검 유형</label>
                    <select id="typeFilter">
                        <option value="">전체</option>
                        <option value="일반점검">일반점검</option>
                        <option value="세부점검">세부점검</option>
                    </select>
                </div>
            </div>
            <button class="btn-excel-download" id="excelDownloadBtn">
                <i class="fas fa-file-excel"></i>
                엑셀 다운로드
            </button>
        </div>

        <!-- 정비내역 타임라인 -->
        <div class="history-section">
            <h2><i class="fas fa-list"></i> 점검 기록 (<span id="historyCount">0</span>건)</h2>
            <div id="historyTimeline" class="history-timeline">
                <!-- 동적으로 생성 -->
            </div>
        </div>

        <!-- 로딩 표시 -->
        <div id="loadingIndicator" class="loading-indicator">
            <i class="fas fa-spinner fa-spin"></i>
            <p>정비내역을 불러오는 중...</p>
        </div>

        <!-- 결과 없음 표시 -->
        <div id="noHistory" class="no-history" style="display: none;">
            <i class="fas fa-inbox"></i>
            <h3>정비내역이 없습니다</h3>
            <p>이 장비에 대한 점검 기록이 없습니다.</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSvObiEPfQkEfSLRzyg2BdCCJmQENJs8ic",
            authDomain: "hvac-management-477fb.firebaseapp.com",
            projectId: "hvac-management-477fb",
            storageBucket: "hvac-management-477fb.firebasestorage.app",
            messagingSenderId: "812239966797",
            appId: "1:812239966797:web:b454d99fde982328f7dea04",
            measurementId: "G-f14YESP0P1"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db;
    </script>
    <!-- SheetJS 라이브러리 (엑셀 다운로드용) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/main.js"></script>
    <script src="js/equipment-history.js"></script>
</body>
</html>
